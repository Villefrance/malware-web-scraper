import csv
import sys

import matplotlib.pyplot as plt
import numpy as np

signature_names = []
cuckoo_signature_amounts = []
cape_signature_amounts = []

with open(sys.argv[1], newline='') as signatures_file:
    signatures_reader = csv.reader(signatures_file, dialect='excel')
    for row in signatures_reader:
        if "signature" in row[0] and "cuckoo_count" in row[1] and "cape_count" in row[2]: # first row containing header names
            continue
        #if row[1] == '1' or row[2] == '1': # filtering out signatures where either sandbox only has a count of 1
        #    continue
        if row[4] < '3' or row[8] < '3': # filtering out signatures where either sandbox has a severity under 3
            continue
        if int(row[1]) < 50 or int(row[2]) < 50: # filtering out signatures where either sandbox has a count under 50
            continue
        signature_names.append(row[0])
        cuckoo_signature_amounts.append(int(row[1]))
        cape_signature_amounts.append(int(row[2]))

    print(signature_names)
    print(cuckoo_signature_amounts)
    print(cape_signature_amounts)

    x = np.arange(len(signature_names))
    width = 0.25

    fig, ax = plt.subplots()
    bar1 = ax.bar(x - width / 2, cuckoo_signature_amounts, width, label='Cuckoo')
    bar2 = ax.bar(x + width / 2, cape_signature_amounts, width, label='Cape')

    ax.set_ylabel('Count')
    #ax.set_ylim([0, 400])
    ax.set_xticks(x)
    ax.set_xticklabels(signature_names, rotation=90)
    ax.legend()

    ax.bar_label(bar1, padding=3)
    ax.bar_label(bar2, padding=3)

    plt.tight_layout()
    plt.show()

signature_names = []
cuckoo_signature_amounts = []
cape_signature_amounts = []

with open(sys.argv[1], newline='') as signatures_file:
    signatures_reader = csv.reader(signatures_file, dialect='excel')
    for row in signatures_reader:
        if "signature" in row[0] and "cuckoo_count" in row[1] and "cape_count" in row[2]: # first row containing header names
            continue
        #if row[1] == '1' or row[2] == '1': # filtering out signatures where either sandbox only has a count of 1
        #    continue
        if row[4] < '3' or row[8] < '3': # filtering out signatures where either sandbox has a severity under 3
            continue
        if int(row[1]) > 50 or int(row[2]) > 50: # filtering out signatures where either sandbox has a count under 50
            continue
        signature_names.append(row[0])
        cuckoo_signature_amounts.append(int(row[1]))
        cape_signature_amounts.append(int(row[2]))

    print(signature_names)
    print(cuckoo_signature_amounts)
    print(cape_signature_amounts)

    x = np.arange(len(signature_names))
    width = 0.25

    fig, ax = plt.subplots()
    bar1 = ax.bar(x - width / 2, cuckoo_signature_amounts, width, label='Cuckoo')
    bar2 = ax.bar(x + width / 2, cape_signature_amounts, width, label='Cape')

    ax.set_ylabel('Count')
    #ax.set_ylim([0, 400])
    ax.set_xticks(x)
    ax.set_xticklabels(signature_names, rotation=90)
    ax.legend()

    ax.bar_label(bar1, padding=3)
    ax.bar_label(bar2, padding=3)

    plt.tight_layout()
    plt.show()

import json
import os
import sys

#os.chdir(sys.argv[1])
print("Generating json file with av_labels based on single Cuckoo json file: " + sys.argv[1])



with open(sys.argv[1], "r") as cuckoo_file:
    cuckoo_data = json.load(cuckoo_file)
    for cuckoo_sample in cuckoo_data:
        if "virustotal_reports" in cuckoo_sample:
            if cuckoo_sample["virustotal_reports"] != "":
                total_label_list = []
                for label in cuckoo_sample["virustotal_reports"]:
                    label_list = []
                    label_list.append(label["category"])
                    label_list.append(label["ioc"])
                    total_label_list.append(label_list)
                with open(sys.argv[2], "a") as output_file:
                    data_set = {"sha256": cuckoo_sample["sha256"], "sha1": cuckoo_sample["sha1"], "md5": cuckoo_sample["md5"], "av_labels": total_label_list}
                    json.dump(data_set, output_file)
                    output_file.write("\n")

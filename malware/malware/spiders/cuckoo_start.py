import scrapy
from scrapy_playwright.page import PageMethod


class CuckooStartSpider(scrapy.Spider):
	name = "cuckoo_start"
	allowed_domains = ["cuckoo.cert.ee"]
	#start_urls = ["http://test.com/"]

	def start_requests(self):
		yield scrapy.Request(
			url="https://cuckoo.cert.ee/analysis/",
			meta={
				"playwright": True,
				"playwright_page_methods": [
					PageMethod("wait_for_selector", "table#recent tbody tr")
				]
			})

	def parse(self, response):
		#self.state['items_count'] = self.state.get('items_count', 0) + 1
		#self.state['starting_id'] = response.css('table#recent tbody tr td strong::text').get()
		yield {
			"max_id": response.css('table#recent tbody tr td strong::text').get()
		}
